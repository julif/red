<!doctype html>
<html>
<head>
  <title>Webapp</title>
  <meta name="viewport" content="width=device-width,  initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <meta charset="utf-8"/>
  <link rel="manifest" href="manifest.json">  
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script><!-- --- Jquery --- -->
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>



  <!-- <meta name="application-name" content="web-app "> -->
  <!-- <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="application-name" content="web-app ">
  <meta name="apple-mobile-web-app-title" content="web-app ">
  <meta name="msapplication-starturl" content="/">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> -->
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="img/apple-touch-icon-57x57.png" />
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="img/apple-touch-icon-114x114.png" />
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="img/apple-touch-icon-72x72.png" />
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="img/apple-touch-icon-144x144.png" />
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="img/apple-touch-icon-60x60.png" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="img/apple-touch-icon-120x120.png" />
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="img/apple-touch-icon-76x76.png" />
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="img/apple-touch-icon-152x152.png" />
  <link rel="icon" type="image/png" href="img/favicon-196x196.png" sizes="196x196" />
  <link rel="icon" type="image/png" href="img/favicon-96x96.png" sizes="96x96" />
  <link rel="icon" type="image/png" href="img/favicon-32x32.png" sizes="32x32" />
  <link rel="icon" type="image/png" href="img/favicon-16x16.png" sizes="16x16" />
  <link rel="icon" type="image/png" href="img/favicon-128.png" sizes="128x128" />
  <meta name="application-name" content="&nbsp;"/>
  <meta name="msapplication-TileColor" content="#FFFFFF" />
  <meta name="msapplication-TileImage" content="img/mstile-144x144.png" />
  <meta name="msapplication-square70x70logo" content="img/mstile-70x70.png" />
  <meta name="msapplication-square150x150logo" content="img/mstile-150x150.png" />
  <meta name="msapplication-wide310x150logo" content="img/mstile-310x150.png" />
  <meta name="msapplication-square310x310logo" content="img/mstile-310x310.png" />
  <script type="text/javascript">
    if (navigator.serviceWorker) {
      navigator.serviceWorker.register('sw.js').then(function(registration) {
        console.log('ServiceWorker registration successful with scope:',  registration.scope);
      }).catch(function(error) {
        console.log('ServiceWorker registration failed:', errror);
      });
    }
  </script>
  <!--  font awesome -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
  <!--  animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
  <!-- popper.js -->
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <!-- css -->
  <link rel="stylesheet" href="style.css"> 
  <link rel="stylesheet" href="css/portrait.css"> 
  <link rel="stylesheet" href="css/ad2hs_prompt.css"> 
  <link rel="stylesheet" href="css/full.css"> 
  <link rel="stylesheet" href="css/animations.css"> 
  <style>/* extra css */
carta{
    display: inline-block;
    background-color: #9a9696;
    padding: 14px;
    margin: 5px;
    cursor: pointer;
  }
#terminar_turno_btn{
  border: none;
  background-color: black;
  color: white;
  padding: 16px;
  margin: 5px;
  cursor: pointer;
} 
.modal{
background-color: #0e0e0eb0;
    position: fixed;
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
    display: none;
    z-index: 2;
    top: 0;
  } 
  #zona_cartas{
    position: relative;
}
  #tapar_mano{
  background-color: #3126264d;
  background-color: transparent;
    position: absolute;
    width: 100%;
    height: 100%;
    
    display: none;
  } 
  #mano{
  min-height: 56px;
  } 
  </style>
</head>
<body id="contenedor">
  <div id="full">
    <div id="tooltip"  role="tooltip">
      <i class="fas fa-info-circle"></i><span id="tooltip_message" >  se recomienda pantalla completa </span>
      <div id="arrow" data-popper-arrow></div>
    </div>
    <button id="fullwiev" onclick="lock('landscape')">
      <i class="fa fa-expand"></i>
    </button>
  </div>
  <portrait id="portrait"> 
    <section> 
    <img src="img/portrait_roja.png"> 
    </section> 
  </portrait>
  <landscape id="landscape"> 
    <section id="splash">
      <img src="julif.svg">
      <!-- precargar imagen de splash_art -->
      <div  id="precarga_img_splash-art" class="preloader"><!-- contenido del preloader --></div>
    </section>
    <section id="splash_art"  style="display: none;">
      <div style="text-align: center;">
        <img src="img/logo4.png" style="width: 45%;height: auto;">
    <div id="preloader_container">
      <div id="preloader_bar_background">
        <div id="preloader_bar"></div>
      </div>
    </div>
    </div>
    </section>
    <div  id="precarga_main_menu" class="preloader"><!-- contenido del preloader --></div>
    <section id="main_menu"  style="display: none;"> 
      <div>
      <h1> Main menu </h1>
    
        <button onclick="go_to_seleecion_de_enemigos()" > Jugar </button>
      </div>
    
    </section>
    <section id="stage"  style="display: none;     background-color: #3d3c44;"> 


      <div id="turno_enemigo_modal" class="modal"> turno enemigo </div>
      <div id="turno_jugador_modal" class="modal"> tu turno </div>
      <div id="vidas" style="display: flex;">
        <div style="padding: 15px;">
          <p> aliado </p>
          <div id="vida">100</div>
        </div>
        <div  style="padding: 15px;">
        <p id="nombre_enemigo"> enemigo </p>
        <div id="vida_enemiga" style="margin-left: 10px;">100</div>
        </div>
      </div>
    <div id="zona_cartas"> 
      <div id="tapar_mano"></div>
    <div id="mano"></div>
    <button  id="terminar_turno_btn" onclick="terminar_turno()">Terminar turno</button>
    </div>
    <div id="victoria_modal" class="modal"> victoria!! </div>
    
    </section>
  </landscape>
  <!--  ad2hs prompt  -->
  <div id="ad2hs-prompt-container"  class="animate__slideInUp">
    <div id="ad2hs-prompt-container-content"> 
      <div id="ad2hs-logo-container"> <img src="img/apple-touch-icon-60x60.png"> </div> 
      <div id="ad2hs-name-description-container"> 
        <div id="ad2hs-close"> <i  style="color: #b7b6b6" class="fas fa-times"></i> </div>
        <b><p id="ad2hs_app_name"  style="color: black;font-size: 20px;"> Webapp </p></b>
        <p id="ad2hs_web_name" style="color: #b7b6b6;font-size: 15px;"> Julif.github.com </p>
      </div> 
    </div> 
    <!-- <div id="ad2hs-prompt-container-footer"> <button id="ad2hs-button">Add to home screen</button> </div> -->
    <div id="ad2hs-prompt-container-footer"> <button id="ad2hs-button"> Instalar Webapp </button> </div>
  </div> 
  <p id="version" >version de la app </p>
</body> 
<script type="text/javascript" src="js/ad2hs_prompt.js"></script>
<script type="text/javascript" src="js/fade_div.js"></script>
<script type="text/javascript" src="js/fullscreen.js"></script>
<script type="text/javascript" src="app_info.js"></script>
<script type="text/javascript" src="js/precargas_splashart_mainmenu.js"></script>
 <!-- tooltip -->
 <script src='js/tooltip.js' type='text/javascript'></script>

<script> 
  document.title = app_name;
  document.querySelector('#ad2hs_app_name').innerHTML =  app_name;
  document.querySelector('#ad2hs_web_name').innerHTML =  app_web;
  document.querySelector('#version').innerHTML =  app_version;
  // $('meta[name=application-name]').attr('content',  app_name );
</script>  
<script>/* extra js */
// setTimeout(function(){  fadediv(splash,splash_art);  }, 4000);

// esconder el boton fullwiev si la pantalla ya esta en maximisada
if (window.matchMedia('(display-mode: fullscreen)').matches) {  
    // do things here  
    // set a variable to be used when calling something  
    // e.g. call Google Analytics to track standalone use 
    document.getElementById("full").style.display= "none";
    //  iniciar_splash();
} 







function go_to_seleecion_de_enemigos(){

// document.getElementById("main_menu").style.display="none";
// document.getElementById("stage").style.display="inherit";

go_to_section( 'main_menu','stage');

}
</script>  
<script>
var base_de_datos_de_cartas = [
  { 
    ID_carta: 'a1',
    nombre: 'ataque normal',
    tipo: 'ataque',
    area_de_efecto: 'enemigo',
    coste: 1,
    rareza: 'normal',
    es_recompenza: true,
    valor: 10,
    imagen: 'img/1.png',
    rareza: 'normal'
  },
  { 
    ID_carta: 'a2',
    nombre: 'ataque pesado',
    tipo: 'ataque',
    area_de_efecto: 'enemigo',
    coste: 2,
    rareza: 'normal',
    es_recompenza: true,
    valor: 40,
    imagen: 'img/2.png',
    rareza: 'raro'
  }
]; 
</script>
<script>
  var enemigos = [
  { 
    nombre: 'enemigo 1',
    ataque: 10,
    vida: 40
  },
  { 
    nombre: 'enemigo 2',
    ataque: 20,
    vida: 60
  },
  { 
    nombre: 'enemigo 3',
    ataque: 30,
    vida: 80
  }
]; 





cartas_iniciales = [
  "a1", /* ataque normal */
  "a1", /* ataque normal */
  "a1", /* ataque normal */
  "a1", /* ataque normal */
  "a1", /* ataque normal */
  "a2"  /* ataque pesado */
];
</script>

<script>

  
 //funciones re-utilizables
function console_log_array(item, index) {
  console.log(item)
} 
function mezclar(array) {
  array.sort(function() {return Math.random() - 0.5})
}
// crear el array  de mazo y usados ------------------
var mazo = [];
var usados = [];

///crear mazo_inicial
cartas_iniciales.forEach(crear_mazo_inicial);

function crear_mazo_inicial(item, index, arr) {
  uid = index +1; /* ID unico */
  var filter_results = base_de_datos_de_cartas.find( elem => elem.ID_carta === item);
  mazo.push( { nombre:  filter_results.nombre , ID_carta:   filter_results.ID_carta , unique_ID: uid});
}

//var mazo = cartas_iniciales.slice();
mezclar(mazo); //mezclar
console_log_array(mazo);
//console.log(mazo_jugador);




//personaje
var puntos_vida = 100;
document.getElementById("vida").innerHTML = puntos_vida;


// numero random para enemigos aleatorios ------------------
var random  =  Math.floor(Math.random() *  enemigos.length);
//enemigo
var puntos_vida_enemigo = enemigos[random].vida;
var atk_enemigo=  enemigos[random].ataque;
document.getElementById("nombre_enemigo").innerHTML = enemigos[random].nombre;
document.getElementById("vida_enemiga").innerHTML = puntos_vida_enemigo;

function robar(){
  var mazolength = mazo.length;
  var usadoslength = usados.length;
  if (mazolength >= 1) {
    var ID_carta = mazo[0].ID_carta;
    var nombre = mazo[0].nombre;
    var unique_ID = mazo[0].unique_ID;
    /* var value = mazo[0].value; */
    document.getElementById("mano").innerHTML += '<carta id="'+unique_ID+'" ID_carta="'+ ID_carta +'" onclick="ataque(this)" >' + nombre + ' </br> UID:'+ unique_ID +'</carta>';

    mazo.shift();//quita el primer elemento de mazo
  }
  else if ( mazolength == 0) { 
    //var usadoslength= $("#usados").find("li").length ;

    if ( usadoslength >= 1) { 
      console.log('re-mezclar');
      mazo = mazo.concat(usados);
      usados = [];
      mezclar(mazo); //mezclar
      robar();
    }//  if ( usadoslength >= 1) 
    else if ( usadoslength == 0) {  alert(" no hay cartas para robar ");}
  }//else if ( mazolength == 0)
}//robar
/*  robar();
 robar();
 robar(); */
// robar_cartas_automaticamente();
document.getElementById("tapar_mano").style.display="inherit";
 mostrar_turno_jugador_modal()

 function mostrar_turno_jugador_modal(){setTimeout(function(){
    document.getElementById("turno_jugador_modal").style.display="flex";
    ocultar_turno_jugador_modal();
  }, 1000);}//mostrar_turno_jugador_modal()

  function ocultar_turno_jugador_modal(){setTimeout(function(){     
      document.getElementById("turno_jugador_modal").style.display="none";
      robar_cartas_automaticamente(); 
  }, 1100);}//ocultar_turno_jugador_modal()

//ataque
function ataque(e) {
  //document.getElementById("usados").innerHTML += "<li id='"+ +"'>"+  +"</li>";
  var nombre = e.innerHTML;
  var id = e.id;
  var ID_carta = e.getAttribute("ID_carta");
  usados.push( {nombre:  nombre  ,id:  id, ID_carta: ID_carta });


   // toma los datos de la carta por su id
   var filter_results = base_de_datos_de_cartas.find( elem => elem.ID_carta === ID_carta);
  //  console.log( filter_results );

 


  console.log(e.id + " ID_carta: "+ ID_carta);
  $("#"+id).remove();
  puntos_vida_enemigo = puntos_vida_enemigo -  filter_results.valor;
  document.getElementById("vida_enemiga").innerHTML = puntos_vida_enemigo;

  //chequea si el enemigo esta muerto
  if (puntos_vida_enemigo <= 0) {
    setTimeout(victoria, 200);
    function victoria() {
      //alert('Victoria');
      document.getElementById("victoria_modal").style.display="flex"; 
    }//victoria()
  }//if (puntos_vida_enemigo <= 0)
}//atque()


function terminar_turno() {
  document.getElementById("tapar_mano").style.display="inherit";


  mostrar_turno_enemigo_modal();
  function mostrar_turno_enemigo_modal(){setTimeout(function(){     
    document.getElementById("turno_enemigo_modal").style.display="flex"; 
    ocultar_turno_enemigo_modal();
  }, 500);}//mostrar_turno_enemigo_modal()

  function ocultar_turno_enemigo_modal(){setTimeout(function(){     
    document.getElementById("turno_enemigo_modal").style.display="none";
    ataques_enemigos()
  }, 1100);}//ocultar_turno_enemigo_modal()

  function ataques_enemigos(){setTimeout(function(){
    puntos_vida = puntos_vida - atk_enemigo;
    //mostrar cambio
    document.getElementById("vida").innerHTML = puntos_vida;
      

  if (puntos_vida <= 0) {
    setTimeout(derrota, 200);
    function derrota() {
      alert('derrota');
    }//victoria()
 }//if (puntos_vida <= 0)

    //llamar al modal
    mostrar_turno_jugador_modal();
  }, 800);}//ataques_enemigos()



  $('#mano carta').each(function(){ 
    var id = $('#mano carta:first-child').attr('id'); // id de el primer li
    var nombre = $('#mano carta:first-child').text(); // id de el primer li

    $('#mano carta:first-child').remove();//quita el primer elemento de mano
    usados.push( {nombre:  nombre  , id:  id });
  });



 // setTimeout(function(){   robar(); robar(); robar() }, 800);







  



}; //terminar_turno() 
function robar_cartas_automaticamente() {
     setTimeout(function(){  
      var max_hand_Size = 3; 
      robo_automatico();
      function robo_automatico() {
        var i = 0;
        var intervalo_entre_robo = setInterval(myTimer, 300);
        function myTimer() {
          robar(); 
          i++;
          if (i== max_hand_Size) { StopDraw();}
        }
        function StopDraw() { clearInterval(intervalo_entre_robo); i = 0; document.getElementById("tapar_mano").style.display="none";}
      } 
    }, 600); 
  }

</script>
</html>